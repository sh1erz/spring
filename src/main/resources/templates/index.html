<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Main</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css">
    <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
</head>
<body style="margin: 0;">
<header th:replace="fragments/header.html :: header"></header>
<h1>Categories</h1>
<div>
    <div th:each="category : ${root_categories}" th:id="${category.id}">
        <button class="category" th:text="${category.name}"
                th:onclick="|makeSubmenu(${category.id})|"></button>
    </div>

</div>
<script th:inline="javascript" type="text/javascript">
    function makeSubmenu(categoryId) {
        $.get({
            url: /*[[ @{/ajax/getSubCategories} ]]*/ null,
            dataType: 'json',
            data: {id: categoryId}
        }).then(function (subCategories) {
            alert('Horray! Someone wrote "' + subCategories + '"!');
            const categoryDiv = document.getElementById(categoryId)
            if (subCategories.length <= 0) {
                const a = document.createElement("a")
                a.setAttribute("href", "/product")
            }
            for (let i = 0; i < subCategories.length; i++) {
                let subcategory = subCategories[i]
                const div = document.createElement("div");
                const b = document.createElement("button");
                alert(subcategory.name)
                div.setAttribute("id", subcategory.id)
                b.setAttribute("onclick", "makeSubmenu(" + subcategory.id + ")")
                b.innerHTML = subcategory.name
                categoryDiv.append(div)
                div.appendChild(b)
            }
        });
    }
</script>
</body>
</html>